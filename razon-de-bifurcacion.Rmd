---
title: "Orden de red y razón de bifurcación"
author: José Ramón Martínez Batlle
output: pdf_document
bibliography: biblio.bib
csl: apa.csl
editor_options: 
  chunk_output_type: console
header-includes:
 \usepackage{float}
 \floatplacement{figure}{H}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Orden de red y razón de bifurcación

El orden de red de curso fluvial es un número entero positivo usado en geomorfología e hidrología como indicativo del grado de ramificación de una red de drenaje, y es un paso importante en el análisis topológicos de redes [@wikistreamorder, @grassrstreamorder]. Existen muchos métodos para establecer el orden de red, pero el más conocido es el de Strahler [@strahler1957quantitative], por su sencillez, consistencia y por ofrecer un procedimiento inequívoco, a diferencia del Horton [@horton1945erosional], al que históricamente sustituye.

\begin{figure}[H]
  \includegraphics{img/orders.png}
  \caption{Ejemplos de métodos de establecimiento del orden de red. Tomado de: GRASS Development Team (2020a)}
\end{figure}


@horton1945erosional define la razón de bifurcación se define como la relación entre el número promedio de cursos fluviales de un orden dado entre el número de cursos del orden inmediatamente mayor (ver figura arriba sobre ejemplos de orden de red. Según el mismo autor, usualmente esta razón es constante para todos los órdenes de red en una cuenca determinada.

Su fórmula es:

$$R_b=\frac{N_u}{N_{u+1}}$$

donde $R_b$ es la razón de bifurcación, $N_u$ es el número de cursos de orden de red $u$, y $N_{u+1}$ es el número de cursos del orden de red inmediatamente mayor.

Por ejemplo, imaginemos una cuenca modelo en la que existen 10 cursos fluviales de orden 1 y 3 de orden 2. La relación de bifurcación sería el resultado de dividir $10/3=3.333$. Dentro de la cuenca modelo, la expectativa sería que haya 1 curso de orden 3, para una razón de bifurcación de $3/1=3$.

Asumiendo que el número de cursos fluviales es función del orden de red, entonces $N_u=f(u)$. Si graficamos el logaritmo del número de cursos por cada orden de red (según el método de Strahler), notaremos que existe una relación lineal entre ambas variables.

A continuación, muestro un ejemplo de cómo calcular la razón de bifurcación con datos reales (cuenca del arroyo Pantuflas, República Dominicana), utilizando el addon de GRASS GIS `r.stream.stats` [@grassrstreamstats]:

```{r, eval=FALSE}
execGRASS(
  "r.stream.stats",
  flags = c('overwrite', 'verbose','o'),
  parameters = list(
    stream_rast = 'order-strahler',
    direction = 'drainage-dir-de-rstr',
    elevation = 'dem',
    output = 'pant_stats.txt'
  )
)
```

```{r, fig.width=5, fig.height=5}
d <- read.csv("pant_stats.txt", skip=1, header=TRUE)
plot(num_of_streams~order, data=d, log="y")
```

> El eje $y$ es log10.

Formulemos entonces la siguiente función:

$$log_{10}N_u=mu$$

donde $N_u$ es el número de cursos de orden $u$, y $m$ es una pendiente por determinar (la base es irrelevante siempre que se utilice la misma de manera consistente a lo largo del ejercicio). Dicha pendiente, en teoría, siempre es negativa, puesto que a mayor orden de red, menor el número de cursos, como de hecho ocurre en el ejemplo graficado. La demostración matemática a continuación así lo demostrará, y la podremos poner en relación con $R_b$.

$$m=\frac{log_{10}N_{u+1}-log_{10}N_u}{({u+1})-u}$$

$$m=\frac{log_{10}N_{u+1}-log_{10}N_u}{1}$$

$$m=log_{10}N_{u+1}-log_{10}N_u$$

$$m=-(log_{10}N_u-log_{10}N_{u+1})$$

$$m=-(log_{10}\frac{N_u}{N_{u+1}})$$

$$m=-log_{10}R_b$$

Por lo tanto, la pendiente de la recta no es más que el opuesto del logaritmo de la razón de bifurcación, tal como se plantea en esta generalización [@costa1997sensitivity]:

\begin{figure}[H]
  \includegraphics{img/rb_pendiente.png}
\end{figure}

Si despejamos a $R_b$, obtenemos entonces entonces:

$$-m=log_{10}R_b$$

$$10^{-m}=R_b$$

$$\frac{1}{10^m}=R_b$$

Volviendo a los datos del arroyo Pantuflas, y dado que lo que necesitamos obtener es la pendiente de la función $log_{10}N_u=mu$, nos será de utilidad construir un modelo de regresión lineal usando mínimos cuadrados:

```{r}
mod <- lm(log10(num_of_streams) ~ order, data=d)
plot(num_of_streams~order, data=d, log="y")
abline(mod)
text(2, 20, 'logN=2.064-0.544u')
```

La pendiente de la regresión es el factor que multiplica al número de orden de red $u$, que en este caso es $-0.544$. Dentro del modelo regresión de R, dicho valor ocupa la posición número 2 del vector de coeficientes del objeto `mod`:

```{r}
mod$coefficients[[2]]
```

Por lo tanto, la $R_b$ se calcularía así:

```{r}
rb <- 1/10^mod$coefficients[[2]]
round(rb,4)
```

Que es el mismo valor de *"Bif.rt."* contenido en la sección *"Stream ratios based on regression coefficient"* generada por el addon `r.stream.stats` en modo expandido:

```{r, eval=FALSE}
execGRASS(
  "r.stream.stats",
  flags = c('overwrite','quiet'),
  parameters = list(
    stream_rast = 'order-strahler',
    direction = 'drainage-dir-de-rstr',
    elevation = 'dem',
    output = 'pant_stats_expanded.txt'
  )
)
```

\begin{figure}[H]
  \includegraphics{img/pant_stats_expanded.png}
\end{figure}


## Referencias
